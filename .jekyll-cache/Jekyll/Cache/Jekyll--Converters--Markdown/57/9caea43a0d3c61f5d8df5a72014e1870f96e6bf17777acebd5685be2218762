I"Ç<h1 id="ç±»å›¾">ç±»å›¾</h1>
<p>ä¹‹å‰æˆ‘ä»¬ç”¨åå°„åˆ›å»ºä¸€ä¸ªç±»çš„å¯¹è±¡å¯ä»¥é€šè¿‡è¯¥Class.newInstance()æ–¹æ³•ï¼Œä½†æ˜¯å¯ä»¥å‘ç°è¿™ä¸ªæ–¹æ³•åªèƒ½æ„é€ åŒ…å«æ— å‚æ„é€ å‡½æ•°çš„ç±»ï¼Œå¦‚æœä¸åŒ…å«åˆ™ä¼šæŠ¥NoSuchMethodExceptionå¼‚å¸¸ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°Constructorç±»äº†ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹Constructorç±»çš„ç±»å…³ç³»å›¾
<img src="/img/doc/reflect/reflect4one.png" alt="ç±»å›¾" /></p>

<h1 id="æºç ç²¾ç®€ç‰ˆ">æºç ï¼ˆç²¾ç®€ç‰ˆï¼‰</h1>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public final class Constructor&lt;T&gt; extends Executable {
    //ç”¨æ¥å­˜å‚¨ConstructorAccessor
    private Constructor&lt;T&gt;      root;
    //é€šè¿‡ä¼ å…¥å‚æ•°æ„é€ ç›¸å¯¹åº”çš„å®ä¾‹
    public T newInstance(Object ... initargs)
        throws InstantiationException, IllegalAccessException,
               IllegalArgumentException, InvocationTargetException
    {
        if (!override) {
            if (!Reflection.quickCheckMemberAccess(clazz, modifiers)) {
                Class&lt;?&gt; caller = Reflection.getCallerClass();
                checkAccess(caller, clazz, null, modifiers);
            }
        }
        if ((clazz.getModifiers() &amp; Modifier.ENUM) != 0)
            throw new IllegalArgumentException("Cannot reflectively create enum objects");
        ConstructorAccessor ca = constructorAccessor;   // read volatile
        if (ca == null) {
            ca = acquireConstructorAccessor();
        }
        @SuppressWarnings("unchecked")
        T inst = (T) ca.newInstance(initargs);
        return inst;
    }
    //è·å–ConstructorAccessor 
    private ConstructorAccessor acquireConstructorAccessor() {
        // First check to see if one has been created yet, and take it
        // if so.
        ConstructorAccessor tmp = null;
        if (root != null) tmp = root.getConstructorAccessor();
        if (tmp != null) {
            constructorAccessor = tmp;
        } else {
            // Otherwise fabricate one and propagate it up to the root
            tmp = reflectionFactory.newConstructorAccessor(this);
            setConstructorAccessor(tmp);
        }

        return tmp;
    }

    // ç›´æ¥è¿”å›rooté‡Œçš„ConstructorAccessor
    ConstructorAccessor getConstructorAccessor() {
        return constructorAccessor;
    }

    // ç»™rootèµ‹å€¼
    void setConstructorAccessor(ConstructorAccessor accessor) {
        constructorAccessor = accessor;
        // Propagate up
        if (root != null) {
            root.setConstructorAccessor(accessor);
        }
    }
}
</code></pre></div></div>
<p>ç”±äºå…¶ä»–æ–¹æ³•åŸºæœ¬éƒ½æ˜¯å¤å†™çš„çˆ¶ç±»ç­‰ï¼Œæ‰€ä»¥è¿™è¾¹å°±åªçœ‹äº†newInstanceæ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡reflectionFactory.newConstructorAccessor(this);æ–¹æ³•è·å–ä¸åŒçš„ConstructorAccessorå¹¶è°ƒç”¨newInstanceåˆ›å»ºä¸€ä¸ªå®ä¾‹</p>

<h1 id="å®ä¾‹">å®ä¾‹</h1>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public class EmployeeDto {
    private int age;
    private String name;

    EmployeeDto() {
        this.age = 0;
        this.name = "default";
    }

    EmployeeDto(int age, String name) {
        this.age = age;
        this.name = name;
    }

    public int getAge() {
        return age;
    }

    public void setAge(int age) {
        this.age = age;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public boolean isOlder(int tmpAge) {
        return age &gt; tmpAge;
    }

    @Override
    public String toString() {
        return "age:" + age + ",name:" + name;
    }
}

public class EmployeeConstructorTest {

    public static void main(String[] args) {
        try {
            Class clazz = Class.forName("reflect.EmployeeDto");
            Constructor[] constructors = clazz.getDeclaredConstructors();
            for (Constructor constructor : constructors) {
                if (constructor.getParameterCount() == 2) {
                    constructor.setAccessible(true);
                    EmployeeDto employeeDto = (EmployeeDto) constructor.newInstance(1,"test");
                    System.out.println(employeeDto);
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
</code></pre></div></div>
<p>EmployeeDtoç±»æœ‰ä¸€ä¸ªå«å‚æ„é€ å‡½æ•°ï¼Œç„¶åmainæ–¹æ³•è·å–åˆ°è¯¥æ„é€ å‡½æ•°å¹¶newInstanceåˆ›å»ºä¸€ä¸ªå®ä¾‹å¹¶æ‰“å°æ„å»ºçš„å¯¹è±¡ï¼Œæˆ‘ä»¬çœ‹çœ‹æ‰§è¡Œç»“æœ</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Connected to the target VM, address: '127.0.0.1:65499', transport: 'socket'
age:1,name:test
Disconnected from the target VM, address: '127.0.0.1:65499', transport: 'socket'
</code></pre></div></div>
<p>æ‰§è¡Œæ²¡æœ‰é—®é¢˜</p>
:ET