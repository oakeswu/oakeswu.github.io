---
layout:     post
title:      "Mysql索引原理"
subtitle:   ""
date:       2020-05-07
author:     "OakesWu"
header-img: "img/post-bg-2015.jpg"
tags:
    - Mysql
---

# 什么是索引
使用过数据库或者ES的工作人员应该对索引不会陌生，因为索引在存储方面是一个很重要的概念，索引可以简单的类比成我们新华字典前面的查找表，索引可以在**查询多于写入**的情况下大幅提升效率，如果没有索引，当sql查询某条件数据时需要从第一条数据开始遍历整张表数据查看所以符合条件的记录，但是如果存在索引就可以直接读取索引文件避免遍历整张表。

# mysql索引原理
索引是在存储引擎中实现的，mysql有很多种存储引擎，这里我们只关注最常用的两种，InnoDB和MyISAM引擎(sql语句show variables like '%storage_engine%'可以查看当前数据库采用的什么引擎)。这两种引擎都只支持BTREE索引，但是这两种引擎又存在区别（聚簇索引和非聚簇索引），下面我们来看下：
- InnoDB聚簇索引
innoDB的主索引是聚簇索引，就是表数据存在于索引中的叶子节点，当查询完主索引就能获取到查询所需数据。但是表必会存在一个聚簇索引，当表存在主键时会按照主键生成，如果表中没有主键或者一个合适的的唯一索引，InnoDB内部会以一个包含行ID值的合成列生成一个隐藏的聚簇索引，其他索引称为辅助索引，辅助索引的叶子节点关联着聚簇索引的索引id。
- MyISAM非聚簇索引
MyISAM索引称为非聚簇索引，虽然都是BTREE形式，区别就在于MyISAM的表数据和索引数据是分开的，主索引和辅助索引的叶子节点存储的是行数据的物理地址，然后通过物理地址获取相应的行数据
- 经典图
![聚簇索引和非聚簇索引.png](https://upload-images.jianshu.io/upload_images/9082703-b25d5da0af22480c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

我们可以通过上图很清晰的看出聚簇索引和非聚簇索引查询过程的区别，左边主聚簇索引下叶子节点就是表数据，根据Name生成的辅助索引最后查到叶子节点的主键id，会再去查一下主键索引获取表数据。右边非聚簇索引中主索引和辅助索引最后的叶子节点指向了物理地址中的表数据，所以两种方式的查询会不一样。

# 总结
在Mysql5.5版本之后默认存储引擎就是InnoDB，所以索引采用的就是BTREE索引。索引还有很多注意事项，譬如当字段值种类很少的时候不适合作为索引字段，构建索引会额外的增加构建的成本，所以需要根据情况构建索引。